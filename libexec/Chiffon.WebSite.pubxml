<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project=".\Chiffon.helpers.Targets" />

  <PropertyGroup>
    <SingleAssemblyName>Chiffon.WebSite.AspNet</SingleAssemblyName>
  </PropertyGroup>

  <PropertyGroup>
    <ExcludeFoldersFromDeployment>
      assets
    </ExcludeFoldersFromDeployment>
  </PropertyGroup>

  <ItemGroup>
    <ExcludeFromPackageFiles
      Include="$(MSBuildProjectDirectory)\Properties\Chiffon.snk;
        $(MSBuildProjectDirectory)\packages.config">
      <FromTarget>pubxml</FromTarget>
    </ExcludeFromPackageFiles>
  </ItemGroup>

  <Target Name="_AfterPipelineDeployPhase" AfterTargets="PipelineDeployPhase"
          DependsOnTargets="$(AfterPipelineDeployPhaseDependsOn)" />

  <PropertyGroup>
    <AfterPipelineDeployPhaseDependsOn>
      TransformConfig
    </AfterPipelineDeployPhaseDependsOn>
  </PropertyGroup>

  <!-- Transforme Web.config pour la plate-forme demandée -->
  <Target Name="TransformConfig">
    <TransformXml Source="$(PublishUrl)Web.config"
                  Destination="$(PublishUrl)Web.config"
                  Transform="$(TransformsDir)Chiffon.WebSite.$(PackageTarget).config" />
  </Target>

  <!--
  <Target Name="EncryptConfig" DependsOnTargets="GetAspNetRegIis">
    <PropertyGroup>
      <_WebApplicationDirectory>$(PublishUrl.TrimEnd('\'))</_WebApplicationDirectory>
    </PropertyGroup>

    <Exec Command="$(AspNetRegIis) -pef &quot;connectionStrings&quot; &quot;$(_WebApplicationDirectory)&quot; -prov &quot;RsaProvider&quot;" />
  </Target>
  -->

  <!--
  <ItemGroup>
    <ConfigFiles Include="$(ConfigDir)*.config"></ConfigFiles>
  </ItemGroup>

  <Target Name="_CopyConfigs" AfterTargets="PipelineDeployPhase">
    <Copy SourceFiles="@(ConfigFiles)"
          DestinationFiles="@(ConfigFiles->'$(PublishUrl)config\%(Filename)%(Extension)')" />
  </Target>
  -->
</Project>